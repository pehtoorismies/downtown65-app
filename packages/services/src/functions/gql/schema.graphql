scalar AWSDateTime

directive @aws_api_key on OBJECT | FIELD_DEFINITION
directive @aws_oidc on OBJECT

enum EventType {
    CYCLING
    KARONKKA
    MEETING
    NORDIC_WALKING
    ORIENTEERING
    OTHER
    RUNNING
    SKIING
    SPINNING
    SWIMMING
    TRACK_RUNNING
    TRAIL_RUNNING
    TRIATHLON
    ULTRAS
}

interface User {
    id: ID!
    nickname: String!
}

interface DetailedUser  {
    picture: String!
    email: String!
    name: String!
}

type EventParticipant implements User @aws_api_key @aws_oidc {
    id: ID!
    nickname: String!
    joinedAt: AWSDateTime!
    picture: String!
}

type Creator implements User @aws_api_key @aws_oidc {
    id: ID!
    nickname: String!
    picture: String!
}



type Event @aws_api_key @aws_oidc {
    createdBy: Creator!
    dateStart: String! # Should be a AWSDateTime or AWSDate
    description: String
    id: ID!
    location: String!
    participants: [EventParticipant!]!
    race: Boolean!
    title: String!
    type: EventType!
}


type MeUser implements User & DetailedUser @aws_api_key @aws_oidc {
    email: String!
    id: ID!
    name: String!
    nickname: String!
    picture: String!
    preferences: Preferences!
}

type OtherUser implements User & DetailedUser {
    email: String!
    id: ID!
    picture: String!
    name: String!
    nickname: String!
}


input MeInput {
    id: ID!
    picture: String!
    nickname: String!
}

input CreateEventInput {
    createdBy: MeInput!
    dateStart: String!
    description: String
    location: String!
    participants: [MeInput!]
    race: Boolean!
    title: String!
    type: String!
}

type AuthPayload @aws_api_key {
    accessToken: String!
    expiresIn: Int!
    idToken: String!
    refreshToken: String!
}

type Preferences {
    subscribeEventCreationEmail: Boolean!
    subscribeWeeklyEmail: Boolean!
}

type IDPayload {
    id: ID!
}

input UpdateEventInput {
    dateStart: String
    id: ID!
    race: Boolean
    subtitle: String
    title: String
    type: String
}

interface Error {
    message: String!
    path: String!
    code: String!
}

type LoginError implements Error @aws_api_key {
    message: String!
    path: String!
    code: String!
}

type LoginPayload @aws_api_key {
    tokens: AuthPayload
    loginError: LoginError
}

input PreferencesInput {
    subscribeEventCreationEmail: Boolean!
    subscribeWeeklyEmail: Boolean!
}

input SignupInput {
    email: String!
    nickname: String!
    password: String!
    name: String!
    registerSecret: String!
}

interface UserError {
    message: String!
    path: String!
}

enum SignupField {
    name
    password
    registerSecret
    nickname
    email
}

type FieldError @aws_api_key{
    message: String!
    path: SignupField!
}

type SignupPayload @aws_api_key {
    user: User
    errors: [FieldError!]
}

input UpdateMeInput {
    preferences: PreferencesInput!
}

type Query {
    event(eventId: ID!): Event @aws_api_key
    # Future events
    events: [Event!]!
    me: MeUser!
    users: [OtherUser!]!
}

type Mutation {
    createEvent(input: CreateEventInput!): IDPayload!
    updateEvent(input: UpdateEventInput!): Event!
    deleteEvent(eventId: ID!): IDPayload
    leaveEvent(eventId: ID!): Boolean
    joinEvent(eventId: ID!): Boolean

    updateMe(input: UpdateMeInput!): MeUser!

    login(
        email: String!
        password: String!
    ): LoginPayload! @aws_api_key

    signup(input: SignupInput!): SignupPayload! @aws_api_key

    forgotPassword(
        email: String!
    ): Boolean! @aws_api_key
}


